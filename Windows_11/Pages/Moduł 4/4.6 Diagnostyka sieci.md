# 4.6: Diagnostyka sieci

## Wprowadzenie

Diagnostyka sieci w systemie ***Windows*** pozwala na identyfikacj i rozwizywanie problem贸w zwizanych z poczeniem, takich jak brak dostpu do Internetu, bdy konfiguracji **IP** czy niedziaajce usugi sieciowe.

## `ipconfig` - Konfiguracja i informacje o interfejsach sieciowych

**`ipconfig`** to narzdzie wywietlajce konfiguracj sieci, w tym:
- **adres IP**
- **mask podsieci**
- **bram domyln**

Umo偶liwia tak偶e zarzdzanie ustawieniami **DHCP** i **DNS**.

**Skadnia**:

```dos
ipconfig [opcje]
```

**Opcje**:

| Opcja       | Opis                                             |
|:------------|:-------------------------------------------------|
| `/all`      | Wywietla pen konfiguracj sieciow.           |
| `/release`  | Zwalnia adres **IP** uzyskany od serwera **DHCP**.        |
| `/renew`    | Odnawia adres **IP** uzyskany od serwera **DHCP**.                 |
| `/flushdns` | Czyci pami podrczn **DNS**.                 |

#### Przykady wywietlenia danych o interfejsach sieciowych

```dos
ipconfig
```

**Wynik**:

```dos
Windows IP Configuration

Ethernet adapter Ethernet:

    Connection-specific DNS Suffix  . :
    Link-local IPv6 Address . . . . . : fe80::774f:ef9c:cc6a:b769%13
    IPv4 Address. . . . . . . . . . . : 192.168.0.2
    Subnet Mask . . . . . . . . . . . : 255.255.255.0
    Default Gateway . . . . . . . . . :

Ethernet adapter Ethernet 2:

    Connection-specific DNS Suffix  . : home
    IPv6 Address. . . . . . . . . . . : fd00::3c21:5e9f:d56c:2df
    Temporary IPv6 Address. . . . . . : fd00::10c5:b8b8:d84:bd14
    Link-local IPv6 Address . . . . . : fe80::8ff3:386f:7884:7129%18
    IPv4 Address. . . . . . . . . . . : 10.0.2.15
    Subnet Mask . . . . . . . . . . . : 255.255.255.0
    Default Gateway . . . . . . . . . : fe80::2%18
                                        10.0.2.2
```

```dos
ipconfig /all
```

**Wynik**:

```dos
Windows IP Configuration

    Host Name . . . . . . . . . . . . : DESKTOP-M3MJFRF
    Primary Dns Suffix  . . . . . . . :
    Node Type . . . . . . . . . . . . : Hybrid
    IP Routing Enabled. . . . . . . . : No
    WINS Proxy Enabled. . . . . . . . : No
    DNS Suffix Search List. . . . . . : home

Ethernet adapter Ethernet:

    Connection-specific DNS Suffix  . :
    Description . . . . . . . . . . . : Intel(R) PRO/1000 MT Desktop Adapter
    Physical Address. . . . . . . . . : 08-00-27-5E-FB-70
    DHCP Enabled. . . . . . . . . . . : No
    Autoconfiguration Enabled . . . . : Yes
    Link-local IPv6 Address . . . . . : fe80::774f:ef9c:cc6a:b769%13(Preferred)
    IPv4 Address. . . . . . . . . . . : 192.168.0.2(Preferred)
    Subnet Mask . . . . . . . . . . . : 255.255.255.0
    Default Gateway . . . . . . . . . :
    DHCPv6 IAID . . . . . . . . . . . : 218628135
    DHCPv6 Client DUID. . . . . . . . : 00-01-00-01-2F-E4-6E-EC-08-00-27-5E-FB-70
    NetBIOS over Tcpip. . . . . . . . : Enabled

Ethernet adapter Ethernet 2:

    Connection-specific DNS Suffix  . : home
    Description . . . . . . . . . . . : Intel(R) PRO/1000 MT Desktop Adapter #2
    Physical Address. . . . . . . . . : 08-00-27-54-0A-7F
    DHCP Enabled. . . . . . . . . . . : Yes
    Autoconfiguration Enabled . . . . : Yes
    IPv6 Address. . . . . . . . . . . : fd00::3c21:5e9f:d56c:2df(Preferred)
    Temporary IPv6 Address. . . . . . : fd00::10c5:b8b8:d84:bd14(Preferred)
    Link-local IPv6 Address . . . . . : fe80::8ff3:386f:7884:7129%18(Preferred)
    IPv4 Address. . . . . . . . . . . : 10.0.2.15(Preferred)
    Subnet Mask . . . . . . . . . . . : 255.255.255.0
    Lease Obtained. . . . . . . . . . : czwartek, 19 czerwca 2025 20:14:04
    Lease Expires . . . . . . . . . . : pitek, 20 czerwca 2025 20:14:01
    Default Gateway . . . . . . . . . : fe80::2%18
                                        10.0.2.2
    DHCP Server . . . . . . . . . . . : 10.0.2.2
    DHCPv6 IAID . . . . . . . . . . . : 302514215
    DHCPv6 Client DUID. . . . . . . . : 00-01-00-01-2F-E4-6E-EC-08-00-27-5E-FB-70
    DNS Servers . . . . . . . . . . . : 10.0.2.3
                                        fd00::3
    NetBIOS over Tcpip. . . . . . . . : Enabled
```

<div data-hint="success">

Pamitaj, 偶e wyb贸r pomidzy **ipconfig** a **ipconfig /all** zale偶y od tego, jak wiele informacji potrzebujesz.

  - Gdy chcesz sprawdzi **adresy IP** i **mask podsieci**, opcja bez `/all` jest bardziej czytelna.
  - Gdy potrzebujesz adres贸w **DNS** lub fizycznego adresu **MAC** interfejsu, musisz u偶y opcji `/all`.

</div>

#### Przykad: Czyszczenie pamici podrcznej DNS

```dos
ipconfig /flushdns
```

**Wynik**:

```dos
Windows IP Configuration

Successfully flushed the DNS Resolver Cache.
```

<div data-hint="info">

Jeli masz problem z adowaniem stron **WWW**, mo偶esz wyczyci bufor **DNS** systemu, u偶ywajc `ipconfig /flushdns`.  
Alternatywnie, ponowne uruchomienie komputera zawsze czyci bufor, aby unikn korzystania z przestarzaych danych.

Jeli to nie pomo偶e, tw贸j router r贸wnie偶 posiada sw贸j bufor **DNS**.

</div>

## `ping` - Testowanie cznoci sieciowej

**`ping`** to podstawowe narzdzie do sprawdzania cznoci z innym urzdzeniem w sieci poprzez wysyanie pakiet贸w **ICMP** i mierzenie czasu odpowiedzi.

**Skadnia**:

```dos
ping [adres IP || nazwa hosta] [opcje]
```

**Opcje**:

| Opcja         | Opis                                                                                                |
|:--------------|:----------------------------------------------------------------------------------------------------|
| `-t`          | Wysya pingi bez przerwy, a偶 do przerwania (<kbd>Ctrl</kbd>+<kbd>C</kbd>).                             |
| `-n [liczba]` | Okrela liczb wysyanych pakiet贸w (domylnie $$4$$).                                                    |
| `-a`          | Zmienia **adres IP** na nazw *hosta*.                                                                 |
| `-l [rozmiar]`| Okrela rozmiar pakietu w bajtach (domylnie $$32$$).                                                   |
| `-4`          | Wymusza u偶ycie protokou **IPv4**.                                                                    |
| `-6`          | Wymusza u偶ycie protokou **IPv6**.                                                                    |

#### Przykad: Testowanie cznoci z DNS od Google

```dos
ping -a 8.8.8.8
```

**Wynik**:

```dos
Pinging dns.google [8.8.8.8] with 32 bytes of data:
Reply from 8.8.8.8: bytes=32 time=35ms TTL=115
Reply from 8.8.8.8: bytes=32 time=25ms TTL=115
Reply from 8.8.8.8: bytes=32 time=23ms TTL=115
Reply from 8.8.8.8: bytes=32 time=25ms TTL=115

Ping statistics for 8.8.8.8:
    Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),
Approximate round trip times in milli-seconds:
    Minimum = 23ms, Maximum = 35ms, Average = 27ms
```

**Objanienie**:

W pierwszej lini widzisz 偶e dziki argumentowi `-a` poznaem nazw mnemoniczn przypisan do **adresu IP**: `8.8.8.8`. 
  - `time` - czas odpowiedzi w milisekundach.
  - `TTL` - *Time To Live*, liczba przeskok贸w, po kt贸rej pakiet wygasa.
  - `Lost` - liczba utraconych pakiet贸w ($$0 \\%$$ oznacza pen czno).

<div data-hint="info">

Brak odpowiedzi mo偶e oznacza blokad **ICMP** przez zapor sieciow lub brak poczenia z hostem.

</div>

### Pakiety blokowane przez zapor

Domylnie ***Windows*** ma nieskonfigurowane zasady dotyczce wysyania **ping** na protokole **ICMP**.  
Wczona zapora sieciowa bdzie wic blokowa poczenie, co wida na poni偶szym obrazku.
![Blokowany ping przez zapor](https://raw.githubusercontent.com/Edu-Koala-V/images/main/Windows_11/Images/ping-error-wf-enable.webp)

### Konfiguracja nowej zasady dla Zapory Windows Defender

1.  Dodajmy brakujce reguy. Uruchom przystawk `wf.msc` lub <img src="https://raw.githubusercontent.com/Edu-Koala-V/images/main/Windows_11/Images/tarcza-windows.png" alt="Windows Logo" style="display: inline-block; vertical-align: middle; height: 1.5em; padding-bottom: 6px;"><kbd class="win-menu-btn">Ustawienia zaawansowane</kbd> z powy偶szego obrazka, w oknie <img src="https://raw.githubusercontent.com/Edu-Koala-V/images/main/Windows_11/Images/panel-sterowania-icon.png" alt="Control panel Icon" style="display: inline-block; height: 1.2rem; vertical-align: middle;">*Panelu sterowania* .

2.  Musisz utworzy nowe reguy przychodzce i wychodzce dla obu maszyn.  
W kreatorze wybierz zasad o typie: **Niestandardowa**, a na nastpnej stronie pozostaw opcj: **Wszystkie programy**.  
  ![Dodawanie zasady do zapory Windows Defender.](https://raw.githubusercontent.com/Edu-Koala-V/images/main/Windows_11/Images/ping-wf-add-rule-1.webp)


1.  Na stronie <kbd class="win-server-creator">Protok贸 i porty</kbd> musisz wybra protok贸 wymagany do wykonania polecenia `ping`.  
Jest to wczeniej wspomniany **ICMP**, kt贸ry wystpuje w dw贸ch wersjach: dla **IPv4** i **IPv6**.  
Mo偶esz pozostawi wszystkie typy **ICMP**, ale dla sprecyzowania `ping` wykorzystuje typ **$$8$$**, czyli **偶danie echa**.
  ![Dodawanie zasady do zapory Windows Defender.](https://raw.githubusercontent.com/Edu-Koala-V/images/main/Windows_11/Images/ping-wf-add-rule-2.webp)


4.  Kolejne strony to okrelenie adres贸w **IP**, kt贸rych ma dotyczy ta zasada.  
Mo偶esz te偶 bardziej precyzyjnie doda adres, skd poczenie zostanie przepuszczone, okrelajc konkretny adres **IP** lub pul adres贸w (np. z **DHCP**).  
Na kolejnej stronie zdecydujesz, czy konfigurowana zasada bdzie zezwala, czy blokowa poczenia.
  ![Dodawanie zasady do zapory Windows Defender.](https://raw.githubusercontent.com/Edu-Koala-V/images/main/Windows_11/Images/ping-wf-add-rule-3.webp)


5.  Na koniec decydujesz, do kt贸rego profilu ma zosta dodana zasada oraz jak nazw i opis jej nadasz.
  ![Dodawanie zasady do zapory Windows Defender.](https://raw.githubusercontent.com/Edu-Koala-V/images/main/Windows_11/Images/ping-wf-add-rule-4.webp)


W efekcie kocowym ping przechodzi, mimo wczonej zapory.
![Przepuszczany ping przez zapor](https://raw.githubusercontent.com/Edu-Koala-V/images/main/Windows_11/Images/ping-error-wf-enable-fix.webp)


## `tracert` - ledzenie trasy pakiet贸w

**`tracert`** (*traceroute*) ledzi tras pakiet贸w do celu, pokazujc wszystkie routery (przeskoki) midzy komputerem a docelowym hostem.

**Skadnia**:

```dos
tracert [adres IP || nazwa hosta] [opcje]
```

**Opcje**:

| Opcja         | Opis                                                            |
|:--------------|:----------------------------------------------------------------|
| `-d`          | Nie zmienia adres贸w **IP** na nazwy host贸w (przyspiesza dziaanie). |
| `-h [liczba]` | Okrela maksymaln liczb przeskok贸w.                           |
| `-w [czas]`   | Ustawia maksymalny czas oczekiwania na odpowied藕 w milisekundach. |

#### Przykad: ledzenie trasy do google.pl na adres IPv4

```dos
tracert -4 google.pl
```

**Wynik**:

```dos
Tracing route to google.pl [142.250.75.3]
over a maximum of 30 hops:

 1      5 ms   138 ms    15 ms  192.168.0.1
 2     21 ms    21 ms   193 ms  84.116.254.92
 3      * * * Request timed out.
 4      * * * Request timed out.
 5    108 ms    54 ms    55 ms  185-182-244-25.dynamic.play.pl [185.182.244.25]
 6     31 ms    43 ms    20 ms  war-b3-link.ip.twelve99.net [62.115.170.122]
 7     20 ms    21 ms    99 ms  62.115.61.22
 8     33 ms    19 ms    19 ms  64.233.174.229
 9     47 ms    23 ms    19 ms  142.250.238.1
10     77 ms   228 ms    25 ms  waw07s03-in-f3.1e100.net [142.250.75.3]

Trace complete.
```

**Objanienie**:

  - Ka偶dy wiersz pokazuje adres **IP** routera i czas odpowiedzi.
  - Gwiazdki (`*`) oznaczaj brak odpowiedzi (mo偶e by spowodowany blokad **ICMP**).

<div data-hint="info">

#### Ciekawostka

Mo偶esz czy si z dan stron **WwW** za pomoc adresu **IPv4** zamiast nazwy **DNS**:
![Poczenie z stron WwW za pomoc adresu IPv4.](https://raw.githubusercontent.com/Edu-Koala-V/images/main/Windows_11/Images/connect-google-via-ipv4.gif)

</div>

## `nslookup` - Diagnostyka DNS

**`nslookup`** su偶y do wysyania zapyta **DNS** w celu uzyskania adres贸w **IP** powizanych z nazwami domen lub odwrotnie.

**Skadnia**:

```dos
nslookup [nazwa hosta || adres IP] [serwer_DNS]
```

#### Przykad: Zapytanie o adres IP bing.pl

```dos
nslookup bing.pl
```

**Wynik**:

```dos
Server:  UnKnown
Address:  2a02:a302:0:1::10

Non-authoritative answer:
Name:    bing.pl
Addresses:  2620:1ec:33::10
          2620:1ec:33:1::10
          150.171.28.10
          150.171.27.10
```

W powy偶szym wyniku serwer **DNS** ma nieznan nazw. Zazwyczaj jest to wtedy serwer twojego dostawcy Internetu, czyli providera internetu.

Poni偶szy wynik prezentuje wykorzystanie serwer贸w **DNS** od ***Google***:

```dos
Server:  dns.google
Address:  2001:4860:4860::8888

Non-authoritative answer:
Name:    bing.pl
Addresses:  2620:1ec:33:1::10
          2620:1ec:33::10
          150.171.27.10
          150.171.28.10
```

## `netstat` - Statystyki pocze sieciowych

**`netstat`** wywietla aktywne poczenia sieciowe, tabele routingu, statystyki interfejs贸w oraz inne informacje sieciowe.

**Skadnia**:

```dos
netstat [opcje]
```

**Opcje**:

| Opcja         | Opis                                                                 |
|:--------------|:---------------------------------------------------------------------|
| `-a`          | Wywietla wszystkie aktywne poczenia i nasuchujce porty.        |
| `-n`          | Pokazuje adresy i porty w formacie numerycznym (bez nazw).            |
| `-o`          | Wywietla **ID** procesu (**PID**) powizanego z poczeniem.         |
| `-p [protok贸]` | Pokazuje poczenia dla okrelonego protokou (np. **TCP**, **UDP**). |
| `-r`          | Wywietla tabel routingu.                                           |

#### Przykad: Wywietlanie aktywnych pocze z PID

```dos
netstat -ano
```

**Wynik** (Nasuch port贸w dla udzia贸w sieciowych **NetBIOS** i **SMB**):

```dos
Active Connections

 Proto  Local Address        Foreign Address      State            PID
 TCP    0.0.0.0:135          0.0.0.0:0            LISTENING        2036
 TCP    0.0.0.0:445          0.0.0.0:0            LISTENING        4
```

**Objanienie**:

  - `LISTENING` - port nasuchujcy na poczenia.
  - `ESTABLISHED` - aktywne poczenie.
  - `PID` - identyfikator procesu, kt贸ry mo偶na sprawdzi za pomoc **tasklist**.

Sprawdzenie proces贸w przy pomocy `tasklist` i przefiltrowania wierszy zawierajcych dany identyfikator:

```dos
tasklist | find "2036"
svchost.exe                   2036 Services                      0     19 208 K

--------------------------------------------------------------------------------------------

tasklist | find "4"
System                          4 Services                      0      4 448 K
Secure System                 284 Services                      0    109 296 K
smss.exe                      936 Services                      0      1 412 K
csrss.exe                    1504 Services                      0      5 960 K
csrss.exe                    1600 Console                       1      7 024 K
svchost.exe                  1904 Services                      0     35 784 K

(I inne procesy zawierajce "4")...
```

## `arp` - Zarzdzanie tablic ARP

**ARP** (*Address Resolution Protocol*) to protok贸 sieciowy, kt贸ry mapuje adresy **IP** na fizyczne adresy **MAC** (*Media Access Control*) w sieci lokalnej (**LAN**). Polecenie `arp` pozwala wywietla i zarzdza tablic **ARP**, kt贸ra przechowuje te powizania, co jest przydatne w diagnostyce problem贸w z cznoci w sieci.

- Gdy system chce wysa pakiet do urzdzenia w tej samej podsieci (np. `192.168.0.10`), najpierw sprawdza tablic **ARP**, aby znale藕 odpowiadajcy adres **MAC**.  
- Jeli wpisu brak, ***Windows*** wysya rozgoszeniowe zapytanie **ARP** (*broadcast*) na adres **MAC** `FF:FF:FF:FF:FF:FF`, pytajc: <span style="white-space: nowrap;">"**_Kto ma IP $$192.168.0.10$$? Niech poda mi sw贸j adres MAC!が_**"</span>.  
- Urzdzenie o tym **IP** odpowiada swoim adresem **MAC** (<span style="white-space: nowrap;">"**_Ja, $$08:00:27:54:0A:7F$$ ズ_**</span>), a ***Windows*** zapisuje ten wpis w tablicy **ARP**.  
- Nastpnie dane s wysyane w ramce **Ethernet** bezporednio do tego urzdzenia.

#### Dlaczego nie mo偶na u偶y tylko adres贸w IP, skoro ka偶de urzdzenie je ma? 
Wynika to z podziau warstwowego modelu **`ISO/OSI`**.  
Adresy **IP** dziaaj w **warstwie sieciowej** (***warstwa 3***), su偶c do routingu midzy sieciami. W sieci lokalnej dane s przesyane w ramkach **Ethernet** (***warstwa 2***), kt贸re wymagaj adres贸w **MAC**. Przeczniki sieciowe (**Switch**) operuj na adresach **MAC**, a nie **IP**, wic bez **ARP** ***Windows*** nie wiedziaby, do kt贸rego urzdzenia w **LAN** wysa ramk.

<div data-hint="warning">

**ARP** dziaa tylko w sieciach **IPv4**. W **IPv6** u偶ywa si protokou **NDP** (*Neighbor Discovery Protocol*), kt贸ry peni podobn funkcj, ale opiera si na **ICMPv6**.

</div>

**Skadnia**:

```dos
arp [opcje]
```

**Opcje**:

| Opcja             | Opis                                                 |
|:------------------|:-----------------------------------------------------|
| `-a`              | Wywietla tablic **ARP**.                             |
| `-d [adres IP]`   | Usuwa wpis z tablicy **ARP**.                          |
| `-d *`            | Usuwa wszystkie dynamiczne wpisy z tablicy **ARP**.    |
| `-s [adres IP] [adres MAC]` | Dodaje statyczny wpis do tablicy **ARP**.      |

#### Przykad: Wywietlanie tablicy ARP

```dos
arp -a
```

**Wynik**:

```dos
Interface: 192.168.0.69 --- 0x16
  Internet Address      Physical Address      Type
  192.168.0.1           56-47-51-eb-16-0f     dynamic
  192.168.0.146         67-24-33-20-b9-b8     dynamic
  192.168.0.255         ff-ff-ff-ff-ff-ff     static
```

<div data-hint="info">

Czyszczenie tablicy **ARP** (`arp -d *`) mo偶e pom贸c w rozwizaniu problem贸w z cznoci w sieci lokalnej. Po wyczyszczeniu _**Windows**_ wyle nowe zapytania **ARP**, gdy bdzie potrzebowa adres贸w **MAC**.

</div>

#### Przykad: Dodawanie statycznego wpisu

Stosowany, aby zabezpieczy komunikacj z bram domyln (np. przed **ARP spoofingiem**):

```dos
arp -s 192.168.1.1 00-14-22-01-23-45
```

---

# Podcast AI

<audio src="https://raw.githubusercontent.com/Edu-Koala-V/audio_podcast/refs/heads/main/Windows_11/Audio/Diagnozuj_Sie_w_Windows__ipconfig,_ping,_tracert_i_Inne__Tw贸j_Przewodnik_po_Naprawianiu_Pocze.m4a" controls>
Twoja przegldarka nie wspiera odtwarzania plik贸w audio.
</audio>