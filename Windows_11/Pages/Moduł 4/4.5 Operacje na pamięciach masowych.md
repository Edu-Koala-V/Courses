# 4.5: Operacje na pamięciach masowych

## Wprowadzenie

Operacje na pamięciach masowych w _**systemie Windows**_ obejmują zarządzanie dyskami, partycjami, woluminami oraz optymalizację i konserwację nośników danych za pomocą narzędzi konsolowych, takich jak `DiskPart`, `defrag`, `chkdsk` oraz `sfc`.

## `DiskPart` - Zaawansowane zarządzanie dyskami

**DiskPart** to potężne narzędzie konsolowe do zarządzania dyskami, partycjami i woluminami. Działa w trybie interaktywnym, gdzie użytkownik wpisuje komendy po uruchomieniu programu.

---

### Uruchamianie DiskPart

1.  Otwórz **CMD** lub _**Windows Terminal**_ jako administrator.
2.  Wpisz `diskpart` i naciśnij <kbd>Enter</kbd>.

```dos
diskpart
```

<div data-hint="success">

Aby zakończyć pracę w DiskPart, użyj komendy:

```dos
exit
```

</div>

### Podstawowe komendy DiskPart

<div data-hint="info">

Możesz pisać skrótowo:

- `sel` zamiast `select`
- `part` zamiast `partition`
- `del` zamiast `delete`
- `con` zamiast `convert`
- `cre` zamiast `create`
- `pri` zamiast `primary`

Ja zdecydowanie polecam trzy pierwsze, pozostałe działają, ale moim subiektywnym zdaniem obniżają czytelność.

</div>

| Komenda            | Opis                                               |
| ------------------ | -------------------------------------------------- |
| `list disk`        | Wyświetla listę wszystkich dysków.                 |
| `sel disk [numer]` | Wybiera dysk o podanym numerze.                    |
| `detail disk`      | Wyświetla szczegóły wybranego dysku.               |
| `clean`            | Usuwa wszystkie partycje i dane z wybranego dysku. |
| `convert gpt`      | Konwertuje dysk na tablicę partycji **GPT**.       |
| `convert mbr`      | Konwertuje dysk na tablicę partycji **MBR**.       |

<div data-hint="danger">

Komenda `clean` usuwa wszystkie dane z dysku bez możliwości odzyskania w standardowy sposób. Upewnij się, że wybrałeś właściwy dysk!

</div>

| Komenda                                                                                              | Opis                                                                                                                                           |
| :--------------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------- |
| `list part`                                                                                          | Wyświetla partycje na wybranym dysku.                                                                                                          |
| `sel part [numer]`                                                                                   | Wybiera partycję o podanym numerze.                                                                                                            |
| `create part primary size=[MB]`                                                                      | Tworzy partycję podstawową o danym rozmiarze w **$$MB$$**. Niepodanie rozmiaru (`size=`) jest równoznaczne z użyciem całej wolnej przestrzeni. |
| <span style="white-space: nowrap;">`format fs=[system_plików] label="[nazwa woluminu]" quick`</span> | Formatuje aktualną partycję w systemie plików (np. **`NTFS`**, **`FAT32`**) w sposób szybki i nadaje nazwę etykiety dla nowej partycji.        |
| `assign letter=[litera]`                                                                             | Przypisuje literę dysku do partycji.                                                                                                           |
| `delete part`                                                                                        | Usuwa wybraną partycję. Może być wymagane dopisanie `override`.                                                                                |

### `diskpart attributes` - Zmiana atrybutów dysku

Za pomocą `DiskPart` można zmieniać atrybuty dysku, takie jak tylko do odczytu czy status offline.

**Przykład: Ustawienie dysku jako tylko do odczytu**

```dos
diskpart
select disk 1
attributes disk set readonly
exit
```

**Przykład: Usunięcie atrybutu tylko do odczytu**

```dos
diskpart
select disk 1
attributes disk clear readonly
exit
```

---

**Przykład: Ustawienie dysku jako offline**

```dos
diskpart
select disk 1
offline disk
exit
```

**Przykład: Ustawienie dysku jako online**

```dos
diskpart
select disk 1
online disk
exit
```

---

## `defrag` - Defragmentacja i optymalizacja dysków

`defrag` to narzędzie konsolowe do defragmentacji dysków **HDD** oraz optymalizacji **SSD**. Defragmentacja porządkuje fragmenty plików na dysku, poprawiając wydajność odczytu. Na **SSD** optymalizacja polega na wysyłaniu komendy **TRIM**, która pomaga zarządzać wolnymi blokami.

<div data-hint="info">

**TRIM** to komenda w dyskach **SSD**, która informuje kontroler, które bloki danych są już nieużywane (np. po usunięciu plików) i mogą być wyczyszczone.  
Dzięki temu dysk może efektywniej zarządzać wolną przestrzenią, co poprawia wydajność zapisu i przedłuża żywotność **SSD**.

</div>

_**Windows**_ automatycznie planuje optymalizację wszystkich woluminów co tydzień. Jeśli system trzykrotnie nie zdoła przeprowadzić optymalizacji, wymusi ją przy najbliższej okazji.

<div data-hint="danger">

W systemie mogą być widoczne dwa specjalne woluminy: partycja systemowa **EFI** i partycja odzyskiwania.

#### Nigdy nie próbuj optymalizować partycji systemowej **EFI** ani partycji odzyskiwania, ponieważ może to uszkodzić system!!!

![Optymalizacja i defragmentacja woluminów na dyskach](https://raw.githubusercontent.com/Edu-Koala-V/images/main/Windows_11/Images/optymalizacja-dysków.webp)

</div>

**Składnia**:

```dos
defrag [litera_dysku] [opcje]
```

**Opcje**:

- `/C` - Defragmentuje wszystkie woluminy na komputerze.
- `/A` - Analizuje poziom fragmentacji bez defragmentacji.
- `/V` - Wyświetla szczegółowe informacje o procesie.
- `/O` - Wykonuje optymalizację specyficzną dla typu nośnika (**HDD** lub **SSD**).
- `/?` - Pozostałe opcje tak jak przy każdej komendzie CMD.

**Przykład: Analiza fragmentacji dysku D**

```dos
defrag D: /A /V
```

**Przykład: Optymalizacja dysku SSD**

```dos
defrag C: /O
```

<div data-hint="info">

Na dyskach **SSD** regularna defragmentacja nie jest potrzebna, ponieważ nie wpływa znacząco na wydajność.  
Zamiast tego używaj opcji `/O` dla **TRIM**.

</div>

![Przykład wykonania optymalizacji woluminu C: w konsoli CMD](https://raw.githubusercontent.com/Edu-Koala-V/images/main/Windows_11/Images/defrag-c-o.webp)

---

## `chkdsk` - Sprawdzanie i naprawa systemu plików

`chkdsk` to narzędzie do sprawdzania integralności systemu plików i naprawy błędów na dyskach. Może również lokalizować i oznaczać uszkodzone sektory, próbując odzyskać dane.

Różne opcje są przeznaczone dla różnych typów dysków (**HDD**/**SSD**) oraz systemów plików (**`NTFS`**, **`FAT`**/**`FAT32`**/**`exFAT`** ).

**Składnia**:

```dos
chkdsk [litera_dysku] [opcje]
```

#### Opcje i ich zastosowanie

| Opcja       | Opis                                                                        | **HDD**                                | **SSD**                                         | **`NTFS`**                             | **`FAT`**/**`FAT32`**/**`exFAT`**      |
| :---------- | :-------------------------------------------------------------------------- | :------------------------------------- | :---------------------------------------------- | :------------------------------------- | :------------------------------------- |
| `/F`        | Naprawia błędy systemu plików (np. nieprawidłowe wpisy w tablicy alokacji). | <span style="color:#00FF00">Tak</span> | <span style="color:#00FF00">Tak</span>          | <span style="color:#00FF00">Tak</span> | <span style="color:#00FF00">Tak</span> |
| `/R`        | Lokalizuje uszkodzone sektory i próbuje odzyskać dane.                      | <span style="color:#00FF00">Tak</span> | <span style="color:#FF0000">☠️Nie używać</span> | <span style="color:#00FF00">Tak</span> | <span style="color:#00FF00">Tak</span> |
| `/X`        | Wymusza odmontowanie woluminu przed skanowaniem.                            | <span style="color:#00FF00">Tak</span> | <span style="color:#00FF00">Tak</span>          | <span style="color:#00FF00">Tak</span> | <span style="color:#00FF00">Tak</span> |
| `/B`        | Ponownie ocenia uszkodzone klastry.                                         | <span style="color:#00FF00">Tak</span> | <span style="color:#FF0000">☠️Nie używać</span> | <span style="color:#00FF00">Tak</span> | <span style="color:#FF0000">Nie</span> |
| `/L[:size]` | Zmienia rozmiar pliku dziennika (w KB).                                     | <span style="color:#00FF00">Tak</span> | <span style="color:#00FF00">Tak</span>          | <span style="color:#00FF00">Tak</span> | <span style="color:#FF0000">Nie</span> |
| `/I`        | Pomija sprawdzanie indeksów (szybsze skanowanie).                           | <span style="color:#00FF00">Tak</span> | <span style="color:#00FF00">Tak</span>          | <span style="color:#00FF00">Tak</span> | <span style="color:#FF0000">Nie</span> |
| `/C`        | Pomija sprawdzanie cykli w strukturze folderów.                             | <span style="color:#00FF00">Tak</span> | <span style="color:#00FF00">Tak</span>          | <span style="color:#00FF00">Tak</span> | <span style="color:#FF0000">Nie</span> |
| `/V`        | Wyświetla pełne ścieżki i nazwy plików podczas skanowania.                  | <span style="color:#00FF00">Tak</span> | <span style="color:#00FF00">Tak</span>          | <span style="color:#00FF00">Tak</span> | <span style="color:#00FF00">Tak</span> |

<div data-hint="danger">

**Bad sektory na SSD**

**SSD** nie mają tradycyjnych _"bad sektorów"_ jak **HDD**. Zamiast tego używają mechanizmów wewnętrznych (np. **ECC**, **wear leveling**) do zarządzania uszkodzonymi komórkami. Użycie `/R` lub `/B` jest nieefektywne i niepotrzebne. Dodatkowo powoduje niepotrzebne operacje zapisu, skracając żywotność dysku.

</div>

<div data-hint="warning">

Jeśli dysk jest używany (np. `C:`), `chkdsk` może wymagać restartu, aby przeprowadzić skanowanie przy starcie systemu.

</div>

---

## `sfc` - Weryfikacja i naprawa plików systemowych

`sfc` to narzędzie konsolowe do sprawdzania i naprawy uszkodzonych lub brakujących plików systemowych _**Windows**_. Skanuje chronione pliki systemowe i zastępuje uszkodzone wersje oryginalnymi z pamięci podręcznej systemu.

**Składnia**:

```dos
sfc [opcje]
```

#### Opcje

| Opcja                   | Opis                                         |
| :---------------------- | :------------------------------------------- |
| `/scannow`              | Skanuje i naprawia pliki systemowe.          |
| `/verifyonly`           | Tylko skanuje pliki systemowe bez naprawy.   |
| `/scanfile=[ścieżka]`   | Skanuje i naprawia konkretny plik systemowy. |
| `/verifyfile=[ścieżka]` | Tylko skanuje konkretny plik systemowy.      |

**Przykład: Skanowanie i naprawa plików systemowych**

```dos
sfc /scannow
```

**Wynik** (przykładowy):

```
Windows Resource Protection found corrupt files and successfully repaired them.
Details are included in the CBS.Log file located at C:\Windows\Logs\CBS\CBS.log.
```

<div data-hint="info">

Plik dziennika `CBS.log` zawiera szczegóły skanowania. Aby go otworzyć, użyj Notatnika lub polecenia:
`type C:\Windows\Logs\CBS\CBS.log`.

</div>

<div data-hint="warning">

Czasami może się zdarzyć że oprogramowanie firm trzecich np.: sterowniki ingerują w pliki systemowe. Wtedy naprawa może spowodować nowe błędy i problemy.

</div>

---

# Podcast AI

<audio src="https://raw.githubusercontent.com/Edu-Koala-V/audio_podcast/refs/heads/main/Windows_11/Audio/Windows Storage Management_ Console Tools Guide.wav" controls>
Twoja przeglądarka nie wspiera odtwarzania plików audio.
</audio>
