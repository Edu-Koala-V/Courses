# 6.9 Udziay sieciowe

## Wprowadzenie

_**PowerShell**_ zastpuje starsze polecenia **CMD** (`net share`) za pomoc polece, takich jak `Get-SmbShare`, `New-SmbShare` czy `Remove-SmbShare`.  
Dziki tym narzdziom mo偶esz zarzdza udziaami sieciowymi, ustawia uprawnienia dostpu i monitorowa sesje u偶ytkownik贸w.

<div data-hint="warning">

PowerShell u偶ywa protokou **SMB** (*Server Message Block*) do zarzdzania udziaami sieciowymi.

</div>

## Definicja

<div data-hint="info">

**Uprawnienia SMB**: Okrelaj, kto mo偶e uzyska dostp do udziau (np. `Full`, `Read`, `Change`) i s oddzielne od uprawnie **`NTFS`**.

</div>

## Podstawowa skadnia

| Polecenie | Opis |
| :--- | :--- |
| `Get-SmbShare` | Pobiera informacje o udziaach sieciowych w systemie. |
| `New-SmbShare` | Tworzy nowy udzia sieciowy dla okrelonego folderu. |
| `Remove-SmbShare` | Usuwa istniejcy udzia sieciowy. |
| `Set-SmbShare` | Modyfikuje waciwoci udziau, np. uprawnienia lub opis. |
| `Get-SmbShareAccess` | Pobiera informacje o uprawnieniach do udziau sieciowego. |
| `Grant-SmbShareAccess` | Przyznaje uprawnienia dostpu do udziau. |
| `Revoke-SmbShareAccess` | Usuwa uprawnienia dostpu do udziau. |
| `Get-SmbSession` | Wywietla aktywne sesje u偶ytkownik贸w podczonych do udzia贸w. |


## Sprawdzanie udzia贸w sieciowych

Pobiera informacje o wszystkich udziaach sieciowych w systemie.

```powershell
Get-SmbShare
```
![Wynik komendy Get-SmbShare](https://raw.githubusercontent.com/Edu-Koala-V/images/main/Windows_11/Images/powershell-Get-SmbShare.webp)

## Tworzenie udziau sieciowego

Zanim utworzysz udzia sieciowy, musisz upewni si, czy katalog, kt贸rego zawarto bdziesz chcie udostpni, istnieje.  
Mo偶esz to sprawdzi przy pomocy komendy:

```powershell
Get-ChildItem
```

Alternatywnie, skorzystaj z dobrze ci znanego aliasu `dir` lub nawizujcego do _**GNU/Linux**_ *cmdleta* `ls`.

![Wynik komendy Get-SmbShare](https://raw.githubusercontent.com/Edu-Koala-V/images/main/Windows_11/Images/powershell-list-dir-content.webp)

Aby utworzy nowy katalog/plik, u偶yj poni偶szej komendy:

```powershell
New-Item -Path ["lokalizacja"] -Name ["nazwa_i_lub_rozszerzenie"] -ItemType ["typ_zasobu"]
```

| ItemType | Opis |
| :---: | :---: |
| `file` | Plik |
| `directory` | Katalog |
| `registry key` | Klucz rejestru |

Zauwa偶, 偶e ja jako cie偶ce podaem kropk w cudzysowie, aby odwoa si do mojej aktualnej lokalizacji.

![Wynik komendy New-SmbShare](https://raw.githubusercontent.com/Edu-Koala-V/images/main/Windows_11/Images/powershell-make-item-dir.webp)

---

Tworzenie nowego udziau sieciowego dla folderu `C:\SharedFolder` z uprawnieniami penego dostpu dla grupy `Wszyscy`.

```powershell
New-SmbShare -Name ["Nazwa udziau"] -Path ["lokalizacja katalogu do udostpnienia"] -ReadAccess "Wszyscy"
```
![Wynik komendy New-SmbShare](https://raw.githubusercontent.com/Edu-Koala-V/images/main/Windows_11/Images/powershell-make-new-smb-share.webp)


## Poczenie i zmiana lokalizacji na udzia sieciowy

Aby zmieni nasz lokalizacj na udzia sieciowy, mo偶esz skorzysta z dobrze ci znanej komendy `net use` z **CMD** lub podczy go jako dysk sieciowy przy u偶yciu `PSDrive` z **PowerShell**.

### Zmiana lokalizacji przy poczeniu `net use`

Aby zmieni lokalizacj na udzia sieciowy, skorzystaj z:

```powershell
Set-Location ["cie偶ka sieciowa do udziau"]
```

Zmiana lokalizacji bdzie mo偶liwa po uprzedniej autoryzacji za pomoc `net use`.

![Wynik komendy New-SmbShare](https://raw.githubusercontent.com/Edu-Koala-V/images/main/Windows_11/Images/powershell-change-share-location.webp)

PS. Daem dwa razy `ls`, bo za pierwszym razem zapomniaem doda plik w udziale, by pokaza Ci, 偶e mam do niego dostp, i nie chciao mi si robi wszystko od nowa. 

### Podczenie udziau sieciowego jako dysk sieciowy

Komenda `net use` bez `/persistent:yes` jest nietrwaa, co oznacza, 偶e poczenie z udziaem sieciowym jest zawsze zrywane po restarcie systemu.  
Aby je zachowa, podcz udzia jako dysk sieciowy z opcj `/persistent:yes` lub u偶yj polecenia `New-PSDrive` z parametrem `-Persist`.

```powershell
New-PSDrive -Name [Literka] -PSProvider FileSystem -Root ["cie偶ka sieciowa do udziau"] -Credential (Get-Credential) -Persist
```
![Wynik komendy Get-SmbShareAccess](https://raw.githubusercontent.com/Edu-Koala-V/images/main/Windows_11/Images/powershell-shere-disk-change-location.webp)

Teraz tw贸j prompter jest kr贸tszy, a udzia po restarcie systemu si nie odczy.

## Modyfikowanie uprawnie udziau

Przyznaje uprawnienia `Full` u偶ytkownikowi `Jan Kowalski`.

```powershell
Grant-SmbShareAccess -Name ["Nazwa udziau"] -AccountName "Janek" -AccessRight Full
```
![Wynik komendy Grant-SmbShareAccess](https://raw.githubusercontent.com/Edu-Koala-V/images/main/Windows_11/Images/powershell-modify-perm-share.webp)


<div data-hint="warning">

Uprawnienia **SMB** (`Full`, `Change`, `Read`) s niezale偶ne od uprawnie **`NTFS`**.  
Aby u偶ytkownik mia peny dostp, musi mie odpowiednie uprawnienia zar贸wno w **SMB**, jak i **`NTFS`**.

</div>

## Sprawdzanie uprawnie do udziau

Wywietlenie informacji o uprawnieniach dla udziau `"udzia sieciowy smb"`.

```powershell
Get-SmbShareAccess -Name ["Nazwa udziau"]
```
![Wynik komendy Get-SmbShareAccess](https://raw.githubusercontent.com/Edu-Koala-V/images/main/Windows_11/Images/powershell-show-perm-share.webp)

## Monitorowanie sesji u偶ytkownik贸w

Wywietla aktywne sesje u偶ytkownik贸w podczonych do udzia贸w.

```powershell
Get-SmbSession
```
![Wynik komendy Remove-SmbShare](https://raw.githubusercontent.com/Edu-Koala-V/images/main/Windows_11/Images/powershell-session-share.webp)

## Usuwanie udziau sieciowego

Usuwanie udziau sieciowego

```powershell
Remove-SmbShare -Name ["Nazwa udziau"]
```
![Wynik komendy Remove-SmbShare](https://raw.githubusercontent.com/Edu-Koala-V/images/main/Windows_11/Images/powershell-remove-share.webp)

<div data-hint="info">

Usunicie udziau sieciowego nie usuwa folderu ani danych na dysku, a jedynie wycza jego wsp贸dzielenie w sieci.

</div>

## Wa偶na uwaga

**Zapora sieciowa**: Udziay **SMB** wymagaj otwartego portu $$445$$. Sprawd藕 ustawienia zapory:

![Stan zapory sieciowej](https://raw.githubusercontent.com/Edu-Koala-V/images/main/Windows_11/Images/powershell-share-firewall.webp)


---

# Podcast AI

<audio src="https://raw.githubusercontent.com/Edu-Koala-V/audio_podcast/refs/heads/main/Windows_11/Audio/PowerShell SMB Network Shares Management.wav" controls>
Twoja przegldarka nie wspiera odtwarzania plik贸w audio.
</audio>