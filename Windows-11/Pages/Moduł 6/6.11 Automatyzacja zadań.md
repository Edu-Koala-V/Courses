# 6.11 Automatyzacja zadaÅ„

## Wprowadzenie

Na zakoÅ„czenie zabawy z _**PowerShellem**_ stworzymy zautomatyzowane zadanie, ktÃ³re usuwa stare pliki z podanych lokalizacji:

  - ğŸ“ `C:\Windows\Temp`
  - ğŸ“ `%TEMP% (czyli C:\Users\TwojaNazwaUÅ¼ytkownika\AppData\Local\Temp)`
  - ğŸ“ `C:\Windows\SoftwareDistribution\Download`
  - ğŸ“ `C:\Windows\Prefetch`
  - ğŸ“ `C:\Users\TwojaNazwaUÅ¼ytkownika\AppData\Local\Microsoft\Windows\INetCache`
  - ğŸ“ `Kosz (C:\$Recycle.Bin)`
  - ğŸ“ `C:\Users\TwojaNazwaUÅ¼ytkownika\Downloads`

## Uruchamianie skryptu jako Admin

Ten fragment kodu _**PowerShell**_ sprawdza, czy skrypt jest uruchomiony z uprawnieniami administratora, a jeÅ›li nie to uruchamia go ponownie z tymi uprawnieniami.

```powershell
# SprawdÅº, czy skrypt dziaÅ‚a jako administrator
if (-not ([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole(
Â  Â  Â  Â  Â  Â  [Security.Principal.WindowsBuiltInRole] "Administrator")) {

Â  Â  # Scalenie komendy tekstowej z zmiennÄ… Å›rodowiskowÄ… "$PSCommandPath" (lokalizacja odpalonej instancji skryptu) w cudzysÅ‚owu
Â  Â  $BypassExecute = "-ExecutionPolicy Bypass -File " + '"' + $PSCommandPath + '"'
Â  Â  # np.: -ExecutionPolicy Bypass -File "C:\Script\test.ps1"

Â  Â  # Uruchom ponownie jako administrator 
Â  Â  Start-Process powershell $BypassExecute Â -Verb RunAs
Â  Â  exit
}
```

  - `WindowsIdentity::GetCurrent()`: pobiera toÅ¼samoÅ›Ä‡ aktualnie zalogowanego uÅ¼ytkownika.
  - `WindowsPrincipal` pozwala sprawdziÄ‡, czy ta toÅ¼samoÅ›Ä‡ ma okreÅ›lonÄ… rolÄ™.
  - `IsInRole("Administrator")` sprawdza, czy uÅ¼ytkownik ma uprawnienia administratora.

JeÅ›li <u>NIE jest administratorem</u> (`-not`):  
Skrypt uruchamia nowÄ… instancjÄ™ _**PowerShell**_ z parametrem `-Verb RunAs`, co oznacza uruchom jako administrator.

  - `-ExecutionPolicy Bypass` pozwala ominÄ…Ä‡ politykÄ™ wykonywania skryptÃ³w.
  - `$PSCommandPath` to zmienna zawierajÄ…ca Å›cieÅ¼kÄ™ do bieÅ¼Ä…cego skryptu.

`exit` â€” koÅ„czy bieÅ¼Ä…cÄ… (nieuprzywilejowanÄ…) instancjÄ™ skryptu.

---

# Podcast AI

<audio src="https://raw.githubusercontent.com/Edu-Koala-V/audio_podcast/refs/heads/main/Windows_11/Audio/PowerShell_ Automated System Cleanup Tasks.wav" controls>
Twoja przeglÄ…darka nie wspiera odtwarzania plikÃ³w audio.
</audio>